'use strict';

const gistApi = require('gisthrower-api');
const mapper = require('gisthrower-infrastructure').messageMapper;

const printBasicDetails = (chunk) => {
  let printableChunk = mapper.gistBasicDetails(chunk);
  console.log(printableChunk);
};

// TODO: Fix PrintFileDetails
const printFileDetails = (files) => {
  // const pritableArray = files.map(mapper.gistFileDetails);
  // pritableArray.forEach((gist) => { console.log(gist); });
};

// TODO: Fix GetFileUrls
const getFileUrls = (files) => {
  const fileKeys = Object.keys(files);
  return fileKeys.map(key => files[key].raw_url);
};

const basicDetails = (id) => {
  gistApi.gist.get(id)
    .then((chunk) => {
      printBasicDetails(chunk);
    })
    .catch((error) => {
      console.error(error);
    });
};

const downloadFiles = (id) => {
  gistApi.gist.get(id)
    .then((chunk) => {
      const fileUrls = getFileUrls(chunk.files);
      printFileDetails(chunk.files);
      // TODO: Call DownloadFiles
    })
    .catch((error) => {
      console.error(error);
    });
};

module.exports = {
  basic: basicDetails,
  downloadFiles: downloadFiles
};
